<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AI-CHATBOT</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="app">
  <div class="header">AI-CHATBOT</div>

  <div id="chat"></div>

  <div class="input-bar">
    <input id="msg" placeholder="Ask AI-CHATBOT..." autocomplete="off">
    <button onclick="sendChat()">Send</button>
    <input type="file" id="fileInput" hidden>
    <button onclick="pickFile()">Upload</button>
  </div>
</div>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("msg");

// ✅ Enter key send
input.addEventListener("keypress", e => {
  if (e.key === "Enter") sendChat();
});

// ✅ Typing effect
function typeText(el, text, i = 0) {
  if (i < text.length) {
    el.innerHTML += text[i++];
    setTimeout(() => typeText(el, text, i), 15);
  }
}

function addBubble(text, cls) {
  const div = document.createElement("div");
  div.className = "bubble " + cls;
  chat.appendChild(div);
  typeText(div, text);
  chat.scrollTop = chat.scrollHeight;
}

// ✅ Chat
async function sendChat() {
  const msg = input.value.trim();
  if (!msg) return;

  addBubble(msg, "user");
  input.value = "";

  const r = await fetch("/api/chat", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({ prompt: msg })
  });

  const j = await r.json();
  addBubble(formatText(j.reply), "ai");
}

// ✅ File Upload
function pickFile() {
  document.getElementById("fileInput").click();
}

document.getElementById("fileInput").onchange = async e => {
  const file = e.target.files[0];
  if (!file) return;

  addBubble("Uploaded: " + file.name, "user");

  const fd = new FormData();
  fd.append("file", file);

  const r = await fetch("/api/upload", {method:"POST", body:fd});
  const j = await r.json();

  addBubble(j.summary || "Could not analyze file.", "ai");
};

// ✅ Formatting
function formatText(text) {
  return text
    .replace(/\n\n/g,"\n")
    .replace(/\n/g,"\n• ")
    .replace(/^•/,"");
}
</script>

</body>
</html>
