<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI-CHATBOT — AI Studio</title>

  <link rel="stylesheet" href="/static/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">A</div>
        <div class="meta">
          <div class="title" id="brandTitle">AI-CHATBOT</div>
          <div class="subtitle">Classy AI Studio</div>
        </div>
      </div>

      <nav class="tips">
        <div class="section-title">Tips</div>
        <ul>
          <li>Ask anything — chat, code, or brainstorm.</li>
          <li>Click the image button to generate images.</li>
        </ul>
      </nav>
    </aside>

    <main class="main">
      <header class="header">
        <div class="breadcrumbs">Home • Chat</div>
        <button id="clearBtn" class="ghost">New session</button>
      </header>

      <section id="chat" class="chat" aria-live="polite"></section>

      <form id="composer" class="composer" onsubmit="return false;">
        <input id="prompt" type="text" autocomplete="off" placeholder="Ask AI-CHATBOT anything..." />
        <button id="sendBtn" type="button" class="primary">Send</button>
        <button id="imgBtn" type="button" class="secondary">Image</button>
      </form>
    </main>
  </div>

<script>
const chatEl = document.getElementById('chat');
const promptEl = document.getElementById('prompt');

const sessionId = localStorage.getItem('sessionId') || Math.random().toString(36).slice(2);
localStorage.setItem('sessionId', sessionId);

function addBubble(text, cls='assistant', isHtml=false, meta='') {
  const row = document.createElement('div');
  row.className = 'bubble-row ' + (cls === 'user' ? 'row-right' : 'row-left');

  const bubble = document.createElement('div');
  bubble.className = 'bubble ' + (cls === 'user' ? 'user' : 'assistant');
  if (isHtml) bubble.innerHTML = text;
  else bubble.textContent = text;

  row.appendChild(bubble);
  chatEl.appendChild(row);
  chatEl.scrollTop = chatEl.scrollHeight;
}

function addStatus(text) {
  const s = document.createElement('div');
  s.className = 'status';
  s.textContent = text;
  chatEl.appendChild(s);
  chatEl.scrollTop = chatEl.scrollHeight;
  return s;
}

async function sendChat() {
  const val = promptEl.value.trim();
  if (!val) return;

  addBubble(val, 'user');
  promptEl.value = "";

  const thinking = addStatus("Thinking...");

  try {
    const res = await fetch("/api/chat", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ prompt: val, session: sessionId })
    });

    const j = await res.json();
    thinking.remove();

    addBubble(j.reply || "No reply", "assistant");
  } catch (e) {
    thinking.remove();
    addBubble("Error: " + e.message, "assistant");
  }
}

async function sendImage() {
  const val = promptEl.value.trim();
  if (!val) return;

  addBubble(val, 'user');
  promptEl.value = "";

  const status = addStatus("Generating image...");

  try {
    const res = await fetch("/api/generate", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ prompt: val })
    });

    const j = await res.json();
    status.remove();

    const imgHTML = `<img class="generated" src="data:image/png;base64,${j.image}" alt="">`;
    addBubble(imgHTML, "assistant", true);

  } catch (e) {
    status.remove();
    addBubble("Error: " + e.message, "assistant");
  }
}

document.getElementById("sendBtn").onclick = sendChat;
document.getElementById("imgBtn").onclick = sendImage;

document.getElementById("clearBtn").onclick = () => {
  localStorage.removeItem("sessionId");
  location.reload();
};

addBubble("Hello! Ask AI-CHATBOT anything you want.", "assistant");
</script>
</body>
</html>
